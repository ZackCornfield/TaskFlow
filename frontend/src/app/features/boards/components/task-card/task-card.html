<div class="task-card" (click)="taskClick.emit()">
  <div class="task-header">
    <h1 class="task-title">{{ task()?.title }}</h1>
    <button class="btn-delete" (click)="onDelete($event)" title="Delete Task">
      Delete
    </button>
  </div>

  @if (task()?.description) {
  <p class="task-description">{{ task()?.description }}</p>
  }

  <div class="task-footer">
    @let tags = task()?.tags; @if (tags && tags.length > 0) {
    <div class="tags">
      @for (tag of tags.slice(0, 3); track tag.id) {
      <span class="tag" [style.background-color]="tag.color">
        {{ tag.name }}
      </span>
      } @if (tags.length > 3) {
      <span class="tag-more">+{{ tags.length - 3 }}</span>
      }
    </div>
    }
  </div>

  <div class="task-meta">
    <span class="meta-item created-date">Created: {{ task()?.createdAt }}</span>
    @if(task()?.dueDate) {
    <span
      class="meta-item due-date"
      [class.overdue]="isOverdue(task()?.dueDate!)"
      >Due: {{ formatDueDate(task()?.dueDate!) }}</span
    >
    }

    <div class="comments-section">
      <h3>Comments</h3>
      @let comments = task()?.comments; @if (comments && comments.length > 0) {
      <div class="comments-list">
        <div *ngFor="let comment of task()?.comments" class="comment">
          <p class="comment-author">{{ comment.authorId }}</p>
          <p class="comment-content">{{ comment.content }}</p>
          <span class="comment-date">{{ comment.createdAt }}</span>
        </div>
      </div>
      } @else {
      <p class="no-comments">No comments yet.</p>
      }
      <div class="add-comment">
        <textarea
          [(ngModel)]="newComment"
          placeholder="Add a comment..."
        ></textarea>
        <button (click)="onAddComment()" [disabled]="!newComment.trim()">
          Add Comment
        </button>
      </div>
    </div>
  </div>
</div>
